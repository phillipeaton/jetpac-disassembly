<!DOCTYPE html>
<html>
<head>
<title>jetpac: Routine at 6e1b</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">jetpac</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28137.html">6de9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28187">Map</a></td>
<td class="next">
Next: <a href="28262.html">6e66</a>
</td>
</tr>
</table>
<div class="description">6e1b: Fire a laser beam.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="25507.html">63a3</a>, <a href="27189.html">6a35</a>, <a href="27320.html">6ab8</a>, <a href="27640.html">6bf8</a>, <a href="27838.html">6cbe</a> and <a href="28060.html">6d9c</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Alien object.</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">Is either $00 or $01.</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to current active laser beam object.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="28187"></span>6e1b</td>
<td class="instruction">ld de,$0008</td>
<td class="comment-1" rowspan="1">offset</td>
</tr>
<tr>
<td class="address-1"><span id="28190"></span>6e1e</td>
<td class="instruction">ld hl,$5d08</td>
<td class="comment-1" rowspan="1">Laser beam objects</td>
</tr>
<tr>
<td class="address-1"><span id="28193"></span>6e21</td>
<td class="instruction">ld b,$04</td>
<td class="comment-1" rowspan="1">Loop counter (4 laser beams)</td>
</tr>
<tr>
<td class="address-2"><span id="28195"></span>6e23</td>
<td class="instruction">push hl</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>: += 8 after first iteration</td>
</tr>
<tr>
<td class="address-1"><span id="28196"></span>6e24</td>
<td class="instruction">ld a,(hl)</td>
<td class="comment-1" rowspan="3">If current laser beam is in use, try next one</td>
</tr>
<tr>
<td class="address-1"><span id="28197"></span>6e25</td>
<td class="instruction">and a</td>
</tr>
<tr>
<td class="address-1"><span id="28198"></span>6e26</td>
<td class="instruction">jr z,$6e5f</td>
</tr>
<tr>
<td class="address-1"><span id="28200"></span>6e28</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=Y position</td>
</tr>
<tr>
<td class="address-1"><span id="28201"></span>6e29</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=X position: pulse #1</td>
</tr>
<tr>
<td class="address-1"><span id="28202"></span>6e2a</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=X position: pulse #2</td>
</tr>
<tr>
<td class="address-1"><span id="28203"></span>6e2b</td>
<td class="instruction">ld a,(hl)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=pulse #2</td>
</tr>
<tr>
<td class="address-1"><span id="28204"></span>6e2c</td>
<td class="instruction">dec hl</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=X position: pulse #1</td>
</tr>
<tr>
<td class="address-1"><span id="28205"></span>6e2d</td>
<td class="instruction">bit 2,a</td>
<td class="comment-1" rowspan="2">Next iteration is bit-2 of pulse #2 is reset</td>
</tr>
<tr>
<td class="address-1"><span id="28207"></span>6e2f</td>
<td class="instruction">jr z,$6e5f</td>
</tr>
<tr>
<td class="address-1"><span id="28209"></span>6e31</td>
<td class="instruction">and $f8</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28211"></span>6e33</td>
<td class="instruction">sub (ix+$01)</td>
<td class="comment-1" rowspan="1">Subtract alien X position from laser beam X position</td>
</tr>
<tr>
<td class="address-1"><span id="28214"></span>6e36</td>
<td class="instruction">jp p,$6e3f</td>
<td class="comment-1" rowspan="1">If positive number, check position and next iteration</td>
</tr>
<tr>
<td class="address-1"><span id="28217"></span>6e39</td>
<td class="instruction">neg</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28219"></span>6e3b</td>
<td class="instruction">ld c,$08</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28221"></span>6e3d</td>
<td class="instruction">jr $6e41</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="28223"></span>6e3f</td>
<td class="instruction">ld c,$20</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="28225"></span>6e41</td>
<td class="instruction">cp c</td>
<td class="comment-1" rowspan="2">Next iteration if pulse X position is now &gt;= 8/32</td>
</tr>
<tr>
<td class="address-1"><span id="28226"></span>6e42</td>
<td class="instruction">jr nc,$6e5f</td>
</tr>
<tr>
<td class="address-1"><span id="28228"></span>6e44</td>
<td class="instruction">dec hl</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=Y position</td>
</tr>
<tr>
<td class="address-1"><span id="28229"></span>6e45</td>
<td class="instruction">ld a,(hl)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28230"></span>6e46</td>
<td class="instruction">sub (ix+$02)</td>
<td class="comment-1" rowspan="1">Subtract alien Y position from laser beam Y position</td>
</tr>
<tr>
<td class="address-1"><span id="28233"></span>6e49</td>
<td class="instruction">neg</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28235"></span>6e4b</td>
<td class="instruction">jp m,$6e5f</td>
<td class="comment-1" rowspan="1">If subtraction was negative number, next iteration</td>
</tr>
<tr>
<td class="address-1"><span id="28238"></span>6e4e</td>
<td class="instruction">add a,$0c</td>
<td class="comment-1" rowspan="1">else, add 12</td>
</tr>
<tr>
<td class="address-1"><span id="28240"></span>6e50</td>
<td class="instruction">cp (ix+$07)</td>
<td class="comment-1" rowspan="2">Next iteration if &gt;= sprite height</td>
</tr>
<tr>
<td class="address-1"><span id="28243"></span>6e53</td>
<td class="instruction">jp nc,$6e5f</td>
</tr>
<tr>
<td class="address-1"><span id="28246"></span>6e56</td>
<td class="instruction">ld c,$01</td>
<td class="comment-1" rowspan="1">else set return value to $01</td>
</tr>
<tr>
<td class="address-1"><span id="28248"></span>6e58</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="4">Update X position: pulse #1</td>
</tr>
<tr>
<td class="address-1"><span id="28249"></span>6e59</td>
<td class="instruction">ld a,(hl)</td>
</tr>
<tr>
<td class="address-1"><span id="28250"></span>6e5a</td>
<td class="instruction">and $f8</td>
</tr>
<tr>
<td class="address-1"><span id="28252"></span>6e5c</td>
<td class="instruction">ld (hl),a</td>
</tr>
<tr>
<td class="address-1"><span id="28253"></span>6e5d</td>
<td class="instruction">pop hl</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to first byte of current group</td>
</tr>
<tr>
<td class="address-1"><span id="28254"></span>6e5e</td>
<td class="instruction">ret</td>
<td class="comment-1" rowspan="1">We're done here</td>
</tr>
<tr>
<td class="address-2"><span id="28255"></span>6e5f</td>
<td class="instruction">pop hl</td>
<td class="comment-1" rowspan="3">Try next laser beam object</td>
</tr>
<tr>
<td class="address-1"><span id="28256"></span>6e60</td>
<td class="instruction">add hl,de</td>
</tr>
<tr>
<td class="address-1"><span id="28257"></span>6e61</td>
<td class="instruction">djnz $6e23</td>
</tr>
<tr>
<td class="address-1"><span id="28259"></span>6e63</td>
<td class="instruction">ld c,$00</td>
<td class="comment-1" rowspan="2">Return $00</td>
</tr>
<tr>
<td class="address-1"><span id="28261"></span>6e65</td>
<td class="instruction">ret</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28137.html">6de9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28187">Map</a></td>
<td class="next">
Next: <a href="28262.html">6e66</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6b1.</div>
</footer>
</body>
</html>