<!DOCTYPE html>
<html>
<head>
<title>jetpac: Routine at 6a35</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">jetpac</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27181.html">6a2d</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27189">Map</a></td>
<td class="next">
Next: <a href="27320.html">6ab8</a>
</td>
</tr>
</table>
<div class="description">6a35: Update Squidgy Alien.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Alien object.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="27189"></span>6a35</td>
<td class="instruction">ld hl,$5dcb</td>
<td class="comment-1" rowspan="2">Increment current alien number</td>
</tr>
<tr>
<td class="address-1"><span id="27192"></span>6a38</td>
<td class="instruction">inc (hl)</td>
</tr>
<tr>
<td class="address-1"><span id="27193"></span>6a39</td>
<td class="instruction">call <a href="27824.html">$6cb0</a></td>
<td class="comment-1" rowspan="1">Update actor direction</td>
</tr>
<tr>
<td class="address-1"><span id="27196"></span>6a3c</td>
<td class="instruction">call <a href="28187.html">$6e1b</a></td>
<td class="comment-1" rowspan="1">Fire laser beam (returns <span class="register">C</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="27199"></span>6a3f</td>
<td class="instruction">dec c</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27200"></span>6a40</td>
<td class="instruction">jp z,$6aaf</td>
<td class="comment-1" rowspan="1">Add the points for a kill if alien is dead</td>
</tr>
<tr>
<td class="address-1"><span id="27203"></span>6a43</td>
<td class="instruction">call <a href="28137.html">$6de9</a></td>
<td class="comment-1" rowspan="1">Alien collision check (returns <span class="register">E</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="27206"></span>6a46</td>
<td class="instruction">dec e</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27207"></span>6a47</td>
<td class="instruction">jp z,<a href="25686.html">$6456</a></td>
<td class="comment-1" rowspan="1">Alien killed by collision if <span class="register">E</span> is zero</td>
</tr>
<tr>
<td class="address-1"><span id="27210"></span>6a4a</td>
<td class="instruction">xor a</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27211"></span>6a4b</td>
<td class="instruction">ld ($5dc9),a</td>
<td class="comment-1" rowspan="1">Reset alien new direction flag</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27214"></span>
<div class="comments">
<div class="paragraph">
Check which direction alien is travelling after hitting a platform.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27214"></span>6a4e</td>
<td class="instruction">call <a href="30184.html">$75e8</a></td>
<td class="comment-1" rowspan="1">Platform collision (returns <span class="register">E</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="27217"></span>6a51</td>
<td class="instruction">bit 2,e</td>
<td class="comment-1" rowspan="2">Update alien X position if bit-2 is reset</td>
</tr>
<tr>
<td class="address-1"><span id="27219"></span>6a53</td>
<td class="instruction">jr z,$6a6a</td>
</tr>
<tr>
<td class="address-1"><span id="27221"></span>6a55</td>
<td class="instruction">bit 7,e</td>
<td class="comment-1" rowspan="2">Set alien direction to up if bit-7 set</td>
</tr>
<tr>
<td class="address-1"><span id="27223"></span>6a57</td>
<td class="instruction">jr nz,$6a93</td>
</tr>
<tr>
<td class="address-1"><span id="27225"></span>6a59</td>
<td class="instruction">bit 4,e</td>
<td class="comment-1" rowspan="2">Set alien direction to down if bit-4 set</td>
</tr>
<tr>
<td class="address-1"><span id="27227"></span>6a5b</td>
<td class="instruction">jr nz,$6a99</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27229"></span>
<div class="comments">
<div class="paragraph">
Alien has hit the end of a platform: change direction.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="27229"></span>6a5d</td>
<td class="instruction">ld a,e</td>
<td class="comment-1" rowspan="7">Update alien "moving" value</td>
</tr>
<tr>
<td class="address-1"><span id="27230"></span>6a5e</td>
<td class="instruction">and $40</td>
</tr>
<tr>
<td class="address-1"><span id="27232"></span>6a60</td>
<td class="instruction">ld e,a</td>
</tr>
<tr>
<td class="address-1"><span id="27233"></span>6a61</td>
<td class="instruction">ld a,(ix+$04)</td>
</tr>
<tr>
<td class="address-1"><span id="27236"></span>6a64</td>
<td class="instruction">and $bf</td>
</tr>
<tr>
<td class="address-1"><span id="27238"></span>6a66</td>
<td class="instruction">or e</td>
</tr>
<tr>
<td class="address-1"><span id="27239"></span>6a67</td>
<td class="instruction">ld (ix+$04),a</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27242"></span>
<div class="comments">
<div class="paragraph">
Update the alien X position.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27242"></span>6a6a</td>
<td class="instruction">bit 6,(ix+$04)</td>
<td class="comment-1" rowspan="1">Check alien moving left/right bit</td>
</tr>
<tr>
<td class="address-1"><span id="27246"></span>6a6e</td>
<td class="instruction">ld a,(ix+$01)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=alien X position (fetch before the jump)</td>
</tr>
<tr>
<td class="address-1"><span id="27249"></span>6a71</td>
<td class="instruction">jr z,$6a9f</td>
<td class="comment-1" rowspan="1">If moving left, subtract 2 from direction (via jump)</td>
</tr>
<tr>
<td class="address-1"><span id="27251"></span>6a73</td>
<td class="instruction">add a,$02</td>
<td class="comment-1" rowspan="1">otherwise, we add 2 to move right</td>
</tr>
<tr>
<td class="address-2"><span id="27253"></span>6a75</td>
<td class="instruction">ld (ix+$01),a</td>
<td class="comment-1" rowspan="1">Set new X position +/- 2</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27256"></span>
<div class="comments">
<div class="paragraph">
Update the alien Y position, first checking if within the upper/lower bounds of the screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="27256"></span>6a78</td>
<td class="instruction">bit 7,(ix+$04)</td>
<td class="comment-1" rowspan="1">Check alien moving up/down bit</td>
</tr>
<tr>
<td class="address-1"><span id="27260"></span>6a7c</td>
<td class="instruction">ld a,(ix+$02)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=alien Y position (fetch before the jump)</td>
</tr>
<tr>
<td class="address-1"><span id="27263"></span>6a7f</td>
<td class="instruction">jr z,$6aa3</td>
<td class="comment-1" rowspan="1">If moving up, subtract 2 from direction (via jump)</td>
</tr>
<tr>
<td class="address-1"><span id="27265"></span>6a81</td>
<td class="instruction">add a,$02</td>
<td class="comment-1" rowspan="1">otherwise, we add 2 to move down</td>
</tr>
<tr>
<td class="address-2"><span id="27267"></span>6a83</td>
<td class="instruction">ld (ix+$02),a</td>
<td class="comment-1" rowspan="1">Set new alien Y position +/- 2</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27270"></span>
<div class="comments">
<div class="paragraph">
Draw the alien if new direction is set, otherwise repeat collision check again.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="27270"></span>6a86</td>
<td class="instruction">ld a,($5dc9)</td>
<td class="comment-1" rowspan="5">Draw the alien if the new direction flag is set, otherwise, increment the value</td>
</tr>
<tr>
<td class="address-1"><span id="27273"></span>6a89</td>
<td class="instruction">and a</td>
</tr>
<tr>
<td class="address-1"><span id="27274"></span>6a8a</td>
<td class="instruction">jp nz,<a href="27971.html">$6d43</a></td>
</tr>
<tr>
<td class="address-1"><span id="27277"></span>6a8d</td>
<td class="instruction">inc a</td>
</tr>
<tr>
<td class="address-1"><span id="27278"></span>6a8e</td>
<td class="instruction">ld ($5dc9),a</td>
</tr>
<tr>
<td class="address-1"><span id="27281"></span>6a91</td>
<td class="instruction">jr $6a4e</td>
<td class="comment-1" rowspan="1">Jump back and repeat collision check</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27283"></span>
<div class="comments">
<div class="paragraph">
Change alien moving direction to up.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27283"></span>6a93</td>
<td class="instruction">res 7,(ix+$04)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27287"></span>6a97</td>
<td class="instruction">jr $6a6a</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27289"></span>
<div class="comments">
<div class="paragraph">
Change alien moving direction to down.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27289"></span>6a99</td>
<td class="instruction">set 7,(ix+$04)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27293"></span>6a9d</td>
<td class="instruction">jr $6a6a</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27295"></span>
<div class="comments">
<div class="paragraph">
Subtract 2 from the X position (move left).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27295"></span>6a9f</td>
<td class="instruction">sub $02</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27297"></span>6aa1</td>
<td class="instruction">jr $6a75</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27299"></span>
<div class="comments">
<div class="paragraph">
Subtract 2 from the Y position (move up), unless it has reached top of screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27299"></span>6aa3</td>
<td class="instruction">sub $02</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27301"></span>6aa5</td>
<td class="instruction">cp $24</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27303"></span>6aa7</td>
<td class="instruction">jr nc,$6a83</td>
<td class="comment-1" rowspan="1">Return if not at top of screen</td>
</tr>
<tr>
<td class="address-1"><span id="27305"></span>6aa9</td>
<td class="instruction">set 7,(ix+$04)</td>
<td class="comment-1" rowspan="1">Otherwise, set alien to moving down.</td>
</tr>
<tr>
<td class="address-1"><span id="27309"></span>6aad</td>
<td class="instruction">jr $6a83</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27311"></span>
<div class="comments">
<div class="paragraph">
Add score to player if alien is dead.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27311"></span>6aaf</td>
<td class="instruction">ld bc,$0080</td>
<td class="comment-1" rowspan="1">80 points (decimal value)</td>
</tr>
<tr>
<td class="address-1"><span id="27314"></span>6ab2</td>
<td class="instruction">call <a href="28866.html">$70c2</a></td>
<td class="comment-1" rowspan="1">Add points to score</td>
</tr>
<tr>
<td class="address-1"><span id="27317"></span>6ab5</td>
<td class="instruction">jp <a href="27633.html">$6bf1</a></td>
<td class="comment-1" rowspan="1">Kill Alien SFX #1</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27181.html">6a2d</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27189">Map</a></td>
<td class="next">
Next: <a href="27320.html">6ab8</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6b1.</div>
</footer>
</body>
</html>