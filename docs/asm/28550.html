<!DOCTYPE html>
<html>
<head>
<title>jetpac: Routine at 6f86</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">jetpac</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28528.html">6f70</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28550">Map</a></td>
<td class="next">
Next: <a href="28594.html">6fb2</a>
</td>
</tr>
</table>
<div class="description">6f86: Draw laser beam.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="28598.html">6fb6</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">The X Position to start drawing the laser.</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Jetman object (pointing to X position)</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Laser beam object to be drawn (pointing to Y position)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="28550"></span>6f86</td>
<td class="instruction">inc de</td>
<td class="comment-1" rowspan="1">Jetman Y position</td>
</tr>
<tr>
<td class="address-1"><span id="28551"></span>6f87</td>
<td class="instruction">ld a,(de)</td>
<td class="comment-1" rowspan="3">Update the laser beam Y position to align with the middle of the Jetman sprite</td>
</tr>
<tr>
<td class="address-1"><span id="28552"></span>6f88</td>
<td class="instruction">sub $0d</td>
</tr>
<tr>
<td class="address-1"><span id="28554"></span>6f8a</td>
<td class="instruction">ld (hl),a</td>
</tr>
<tr>
<td class="address-1"><span id="28555"></span>6f8b</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="1">Laser X position: pulse #1</td>
</tr>
<tr>
<td class="address-1"><span id="28556"></span>6f8c</td>
<td class="instruction">ld b,$03</td>
<td class="comment-1" rowspan="1">Loop counter</td>
</tr>
<tr>
<td class="address-1"><span id="28558"></span>6f8e</td>
<td class="instruction">ld (hl),c</td>
<td class="comment-1" rowspan="1">Update pulse #1</td>
</tr>
<tr>
<td class="address-1"><span id="28559"></span>6f8f</td>
<td class="instruction">ld a,c</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="28560"></span>6f90</td>
<td class="instruction">and $fb</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="28562"></span>6f92</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="3">Update the rest of the pulses: #2, #3 and #4</td>
</tr>
<tr>
<td class="address-1"><span id="28563"></span>6f93</td>
<td class="instruction">ld (hl),a</td>
</tr>
<tr>
<td class="address-1"><span id="28564"></span>6f94</td>
<td class="instruction">djnz $6f92</td>
</tr>
<tr>
<td class="address-1"><span id="28566"></span>6f96</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="5">Update the laser beam "length" value, using the random_number as a base value</td>
</tr>
<tr>
<td class="address-1"><span id="28567"></span>6f97</td>
<td class="instruction">ld a,($5dce)</td>
</tr>
<tr>
<td class="address-1"><span id="28570"></span>6f9a</td>
<td class="instruction">and $38</td>
</tr>
<tr>
<td class="address-1"><span id="28572"></span>6f9c</td>
<td class="instruction">or $84</td>
</tr>
<tr>
<td class="address-1"><span id="28574"></span>6f9e</td>
<td class="instruction">ld (hl),a</td>
</tr>
<tr>
<td class="address-1"><span id="28575"></span>6f9f</td>
<td class="instruction">inc hl</td>
<td class="comment-1" rowspan="2"><span class="register">DE</span> points to laser beam "colour attribute"</td>
</tr>
<tr>
<td class="address-1"><span id="28576"></span>6fa0</td>
<td class="instruction">ex de,hl</td>
</tr>
<tr>
<td class="address-1"><span id="28577"></span>6fa1</td>
<td class="instruction">ld hl,$6fb2</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=Laser beam colour table</td>
</tr>
<tr>
<td class="address-1"><span id="28580"></span>6fa4</td>
<td class="instruction">ld a,($5dce)</td>
<td class="comment-1" rowspan="6">Use random_number to point <span class="register">HL</span> to one of the values in the colour table</td>
</tr>
<tr>
<td class="address-1"><span id="28583"></span>6fa7</td>
<td class="instruction">and $03</td>
</tr>
<tr>
<td class="address-1"><span id="28585"></span>6fa9</td>
<td class="instruction">ld c,a</td>
</tr>
<tr>
<td class="address-1"><span id="28586"></span>6faa</td>
<td class="instruction">ld b,$00</td>
</tr>
<tr>
<td class="address-1"><span id="28588"></span>6fac</td>
<td class="instruction">add hl,bc</td>
</tr>
<tr>
<td class="address-1"><span id="28589"></span>6fad</td>
<td class="instruction">ld a,(hl)</td>
</tr>
<tr>
<td class="address-1"><span id="28590"></span>6fae</td>
<td class="instruction">ld (de),a</td>
<td class="comment-1" rowspan="1">Assign laser beam "colour attribute" a new colour</td>
</tr>
<tr>
<td class="address-1"><span id="28591"></span>6faf</td>
<td class="instruction">jp <a href="26599.html">$67e7</a></td>
<td class="comment-1" rowspan="1">Laser fire SFX</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28528.html">6f70</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28550">Map</a></td>
<td class="next">
Next: <a href="28594.html">6fb2</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6b1.</div>
</footer>
</body>
</html>