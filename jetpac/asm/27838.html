<!DOCTYPE html>
<html>
<head>
<title>jetpac: Routine at 6cbe</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">jetpac</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27824.html">6cb0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27838">Map</a></td>
<td class="next">
Next: <a href="27971.html">6d43</a>
</td>
</tr>
</table>
<div class="description">6cbe: Update crossed space ship.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Alien object.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="27838"></span>6cbe</td>
<td class="instruction">call <a href="27824.html">$6cb0</a></td>
<td class="comment-1" rowspan="1">Update actor direction</td>
</tr>
<tr>
<td class="address-1"><span id="27841"></span>6cc1</td>
<td class="instruction">ld hl,$5dcb</td>
<td class="comment-1" rowspan="2">Increment alien number</td>
</tr>
<tr>
<td class="address-1"><span id="27844"></span>6cc4</td>
<td class="instruction">inc (hl)</td>
</tr>
<tr>
<td class="address-1"><span id="27845"></span>6cc5</td>
<td class="instruction">call <a href="28187.html">$6e1b</a></td>
<td class="comment-1" rowspan="1">Fire laser beam (returns <span class="register">C</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="27848"></span>6cc8</td>
<td class="instruction">dec c</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27849"></span>6cc9</td>
<td class="instruction">jp z,<a href="27993.html">$6d59</a></td>
<td class="comment-1" rowspan="1">Add points and kill alien (type #3) if dead</td>
</tr>
<tr>
<td class="address-1"><span id="27852"></span>6ccc</td>
<td class="instruction">call <a href="28137.html">$6de9</a></td>
<td class="comment-1" rowspan="1">Alien collision (returns <span class="register">E</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="27855"></span>6ccf</td>
<td class="instruction">dec e</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27856"></span>6cd0</td>
<td class="instruction">jp z,<a href="25686.html">$6456</a></td>
<td class="comment-1" rowspan="1">Alien killed by collision</td>
</tr>
<tr>
<td class="address-1"><span id="27859"></span>6cd3</td>
<td class="instruction">xor a</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="27860"></span>6cd4</td>
<td class="instruction">ld ($5dc9),a</td>
<td class="comment-1" rowspan="1">Reset alien new direction</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27863"></span>
<div class="comments">
<div class="paragraph">
Crossed ship direction change on platform collision.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27863"></span>6cd7</td>
<td class="instruction">call <a href="30184.html">$75e8</a></td>
<td class="comment-1" rowspan="1">Platform collision (returns <span class="register">E</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="27866"></span>6cda</td>
<td class="instruction">bit 2,e</td>
<td class="comment-1" rowspan="2">Update alien X position if bit-2 is reset</td>
</tr>
<tr>
<td class="address-1"><span id="27868"></span>6cdc</td>
<td class="instruction">jr z,$6cf7</td>
</tr>
<tr>
<td class="address-1"><span id="27870"></span>6cde</td>
<td class="instruction">bit 7,e</td>
<td class="comment-1" rowspan="2">Set alien direction to up if bit-7 set</td>
</tr>
<tr>
<td class="address-1"><span id="27872"></span>6ce0</td>
<td class="instruction">jp nz,<a href="28007.html">$6d67</a></td>
</tr>
<tr>
<td class="address-1"><span id="27875"></span>6ce3</td>
<td class="instruction">bit 4,e</td>
<td class="comment-1" rowspan="2">Set alien direction to down if bit-4 set</td>
</tr>
<tr>
<td class="address-1"><span id="27877"></span>6ce5</td>
<td class="instruction">jp nz,<a href="28007.html#28022">$6d76</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27880"></span>
<div class="comments">
<div class="paragraph">
Alien has hit the end of a platform: change direction in a slightly more erratic way than other aliens (note the XOR).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="27880"></span>6ce8</td>
<td class="instruction">ld a,e</td>
<td class="comment-1" rowspan="8">Update alien "moving" value</td>
</tr>
<tr>
<td class="address-1"><span id="27881"></span>6ce9</td>
<td class="instruction">and $40</td>
</tr>
<tr>
<td class="address-1"><span id="27883"></span>6ceb</td>
<td class="instruction">xor $40</td>
</tr>
<tr>
<td class="address-1"><span id="27885"></span>6ced</td>
<td class="instruction">ld e,a</td>
</tr>
<tr>
<td class="address-1"><span id="27886"></span>6cee</td>
<td class="instruction">ld a,(ix+$04)</td>
</tr>
<tr>
<td class="address-1"><span id="27889"></span>6cf1</td>
<td class="instruction">and $bf</td>
</tr>
<tr>
<td class="address-1"><span id="27891"></span>6cf3</td>
<td class="instruction">or e</td>
</tr>
<tr>
<td class="address-1"><span id="27892"></span>6cf4</td>
<td class="instruction">ld (ix+$04),a</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27895"></span>
<div class="comments">
<div class="paragraph">
Move crossed ship horizontally.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27895"></span>6cf7</td>
<td class="instruction">bit 6,(ix+$04)</td>
<td class="comment-1" rowspan="1">Check moving left/right bit</td>
</tr>
<tr>
<td class="address-1"><span id="27899"></span>6cfb</td>
<td class="instruction">ld a,(ix+$01)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=X position (fetch before the jump)</td>
</tr>
<tr>
<td class="address-1"><span id="27902"></span>6cfe</td>
<td class="instruction">jp nz,<a href="28007.html#28029">$6d7d</a></td>
<td class="comment-1" rowspan="1">If moving left, subtract 2 from direction (via jump)</td>
</tr>
<tr>
<td class="address-1"><span id="27905"></span>6d01</td>
<td class="instruction">add a,$02</td>
<td class="comment-1" rowspan="1">otherwise, we add 2 to move right</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27907"></span>
<div class="comments">
<div class="paragraph">
Update the alien YX position.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27907"></span>6d03</td>
<td class="instruction">ld (ix+$01),a</td>
<td class="comment-1" rowspan="1">Set new X position +/- 2</td>
</tr>
<tr>
<td class="address-1"><span id="27910"></span>6d06</td>
<td class="instruction">ld h,$00</td>
<td class="comment-1" rowspan="3"><span class="register">HL</span>=Y speed x 2</td>
</tr>
<tr>
<td class="address-1"><span id="27912"></span>6d08</td>
<td class="instruction">ld l,(ix+$06)</td>
</tr>
<tr>
<td class="address-1"><span id="27915"></span>6d0b</td>
<td class="instruction">add hl,hl</td>
</tr>
<tr>
<td class="address-1"><span id="27916"></span>6d0c</td>
<td class="instruction">ld d,(ix+$02)</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=alien X position</td>
</tr>
<tr>
<td class="address-1"><span id="27919"></span>6d0f</td>
<td class="instruction">ld e,(ix+$05)</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=alien X speed</td>
</tr>
<tr>
<td class="address-1"><span id="27922"></span>6d12</td>
<td class="instruction">bit 7,(ix+$04)</td>
<td class="comment-1" rowspan="2">If alien moving is "up" subtract hl/de</td>
</tr>
<tr>
<td class="address-1"><span id="27926"></span>6d16</td>
<td class="instruction">jr z,<a href="28007.html#28045">$6d8d</a></td>
</tr>
<tr>
<td class="address-1"><span id="27928"></span>6d18</td>
<td class="instruction">add hl,de</td>
<td class="comment-1" rowspan="1">else add them</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27929"></span>
<div class="comments">
<div class="paragraph">
Update vertical position, direction, and speed.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27929"></span>6d19</td>
<td class="instruction">ld (ix+$05),l</td>
<td class="comment-1" rowspan="1">Set alien X speed</td>
</tr>
<tr>
<td class="address-1"><span id="27932"></span>6d1c</td>
<td class="instruction">ld (ix+$02),h</td>
<td class="comment-1" rowspan="1">Alien Y position = <span class="register">H</span></td>
</tr>
<tr>
<td class="address-1"><span id="27935"></span>6d1f</td>
<td class="instruction">ld a,h</td>
<td class="comment-1" rowspan="4">If alien is at top of screen, set to moving down</td>
</tr>
<tr>
<td class="address-1"><span id="27936"></span>6d20</td>
<td class="instruction">cp $28</td>
</tr>
<tr>
<td class="address-1"><span id="27938"></span>6d22</td>
<td class="instruction">jr nc,$6d28</td>
</tr>
<tr>
<td class="address-1"><span id="27940"></span>6d24</td>
<td class="instruction">set 7,(ix+$04)</td>
</tr>
<tr>
<td class="address-2"><span id="27944"></span>6d28</td>
<td class="instruction">bit 7,(ix+$04)</td>
<td class="comment-1" rowspan="1">Check if moving up</td>
</tr>
<tr>
<td class="address-1"><span id="27948"></span>6d2c</td>
<td class="instruction">jr z,<a href="28007.html#28034">$6d82</a></td>
<td class="comment-1" rowspan="1">Change alien direction to down if it is</td>
</tr>
<tr>
<td class="address-1"><span id="27950"></span>6d2e</td>
<td class="instruction">inc (ix+$06)</td>
<td class="comment-1" rowspan="1">else increment Y speed</td>
</tr>
<tr>
<td class="address-1"><span id="27953"></span>6d31</td>
<td class="instruction">jr nz,$6d37</td>
<td class="comment-1" rowspan="1">Jump if it wasn't $FF before the increment</td>
</tr>
<tr>
<td class="address-1"><span id="27955"></span>6d33</td>
<td class="instruction">ld (ix+$06),$ff</td>
<td class="comment-1" rowspan="1">else set Y speed to $FF</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="27959"></span>
<div class="comments">
<div class="paragraph">
Draw the alien if a new direction is set, otherwise repeat platform collision check again.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="27959"></span>6d37</td>
<td class="instruction">ld a,($5dc9)</td>
<td class="comment-1" rowspan="5">Draw the alien if the new direction flag is set, otherwise, increment the value</td>
</tr>
<tr>
<td class="address-1"><span id="27962"></span>6d3a</td>
<td class="instruction">and a</td>
</tr>
<tr>
<td class="address-1"><span id="27963"></span>6d3b</td>
<td class="instruction">jr nz,<a href="27971.html">$6d43</a></td>
</tr>
<tr>
<td class="address-1"><span id="27965"></span>6d3d</td>
<td class="instruction">inc a</td>
</tr>
<tr>
<td class="address-1"><span id="27966"></span>6d3e</td>
<td class="instruction">ld ($5dc9),a</td>
</tr>
<tr>
<td class="address-1"><span id="27969"></span>6d41</td>
<td class="instruction">jr $6cd7</td>
<td class="comment-1" rowspan="1">Jump back and repeat collision check</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27824.html">6cb0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#27838">Map</a></td>
<td class="next">
Next: <a href="27971.html">6d43</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright"></div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6b1.</div>
</footer>
</body>
</html>